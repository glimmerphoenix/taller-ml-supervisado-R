<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Modelos clásicos – Aprendizaje máquina supervisado con R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-modelos-avanzados.html" rel="next">
<link href="./04-seleccion-validacion.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-04e1f1103201cc0a83f720091ef4aae4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-modelos-clasicos.html">Métodos convencionales</a></li><li class="breadcrumb-item"><a href="./05-modelos-clasicos.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Modelos clásicos</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Buscar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Aprendizaje máquina supervisado con R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Fundamentos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduccion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-ml-supervisado.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Aprendizaje máquina supervisado</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-algoritmos-modelos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Algoritmos y modelos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-seleccion-validacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Selección y validación de modelos</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Métodos convencionales</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-modelos-clasicos.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Modelos clásicos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-modelos-avanzados.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelos avanzados</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Entornos de modelado</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tidymodels</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-mlr3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">MLR3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-add-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Recursos adicionales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Apéndices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-command-ref.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Referencia de comandos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./B-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Paquetes R empleados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-refs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#problema-predicción-de-concentración-de-algas-dañinas-en-ríos" id="toc-problema-predicción-de-concentración-de-algas-dañinas-en-ríos" class="nav-link active" data-scroll-target="#problema-predicción-de-concentración-de-algas-dañinas-en-ríos"><span class="header-section-number">5.1</span> Problema: predicción de concentración de algas dañinas en ríos</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets"><span class="header-section-number">5.2</span> Datasets</a></li>
  <li><a href="#descripción-y-preparación-de-datos" id="toc-descripción-y-preparación-de-datos" class="nav-link" data-scroll-target="#descripción-y-preparación-de-datos"><span class="header-section-number">5.3</span> Descripción y preparación de datos</a>
  <ul class="collapse">
  <li><a href="#análisis-descriptivo" id="toc-análisis-descriptivo" class="nav-link" data-scroll-target="#análisis-descriptivo"><span class="header-section-number">5.3.1</span> Análisis descriptivo</a></li>
  <li><a href="#imputación-de-datos-faltantes" id="toc-imputación-de-datos-faltantes" class="nav-link" data-scroll-target="#imputación-de-datos-faltantes"><span class="header-section-number">5.3.2</span> Imputación de datos faltantes</a></li>
  </ul></li>
  <li><a href="#ajuste-de-modelosalgoritmos" id="toc-ajuste-de-modelosalgoritmos" class="nav-link" data-scroll-target="#ajuste-de-modelosalgoritmos"><span class="header-section-number">5.4</span> Ajuste de modelos/algoritmos</a>
  <ul class="collapse">
  <li><a href="#regresión-lineal-múltiple" id="toc-regresión-lineal-múltiple" class="nav-link" data-scroll-target="#regresión-lineal-múltiple"><span class="header-section-number">5.4.1</span> Regresión lineal múltiple</a></li>
  <li><a href="#árboles-de-regresión" id="toc-árboles-de-regresión" class="nav-link" data-scroll-target="#árboles-de-regresión"><span class="header-section-number">5.4.2</span> Árboles de regresión</a></li>
  <li><a href="#random-forests" id="toc-random-forests" class="nav-link" data-scroll-target="#random-forests"><span class="header-section-number">5.4.3</span> Random Forests</a></li>
  </ul></li>
  <li><a href="#predicción-de-valores" id="toc-predicción-de-valores" class="nav-link" data-scroll-target="#predicción-de-valores"><span class="header-section-number">5.5</span> Predicción de valores</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-modelos-clasicos.html">Métodos convencionales</a></li><li class="breadcrumb-item"><a href="./05-modelos-clasicos.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Modelos clásicos</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Modelos clásicos</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>En este apartado vamos a presentar un caso de estudio completo en el que podamos ver paso a paso el proceso de entrenamiento y validación de varios modelos de aprendizaje máquina supervisado.</p>
<p>Vamos a utilizar un conjunto de datos del paquete <code>DMwR2</code>, que ya no está disponible en CRAN. También usaremos otro paquete llamado <code>performanceEstimation</code>, del mismo autor que el anterior. Ambos están disponibles en GitHub y podemos instalarlos con el siguiente código.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)  <span class="co"># Comprueba si está instalado</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">"ltorgo/DMwR2"</span>,<span class="at">ref=</span><span class="st">"develop"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">"ltorgo/performanceEstimation"</span>,<span class="at">ref=</span><span class="st">"develop"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Usaremos los siguientes paquetes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performanceEstimation)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DMwR2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="problema-predicción-de-concentración-de-algas-dañinas-en-ríos" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="problema-predicción-de-concentración-de-algas-dañinas-en-ríos"><span class="header-section-number">5.1</span> Problema: predicción de concentración de algas dañinas en ríos</h2>
<p>El caso de estudio se centra en un conjunto de datos recogidos para estudiar el problema de la proliferación de algas perniciosas en algunos ríos europeos. Las poblaciones de estas algas pueden crecer desmesuradamente en ciertos periodos del año y crean un importante problema para los ecosistemas locales. El caso está desarrollado en <span class="citation" data-cites="torgo_data_2016">(<a href="references.html#ref-torgo_data_2016" role="doc-biblioref">Torgo, 2016</a>)</span>, y todo el código de ejemplo está disponible en http://ltorgo.github.io/DMwR2/Ralgae.html.</p>
<p>Concretamente, se miden varias propiedades químicas del agua (covariables), junto con la frecuencia de aparición de siete especies de algas potencialmente dañinas. También se registran variables con información adicional, como el periodo del año en el que se recogió la muestra, el tamaño del río y la velocidad de sus aguas.</p>
<p>El objetivo del caso de estudio es doble:</p>
<ul>
<li><p>Por una parte, intentar abaratar costes de monitorización, creando un modelo que permita guiar sistemas automáticos de recolección de información que puedan alertar sobre la posible creación de situaciones de riesgo en ecosistemas locales.</p></li>
<li><p>Por otra parte, también se pretende entender mejor los factores que puedan estar influyendo en la aparición de estas algas perniciosas, es decir, identificar si estas frecuencias están correladas de alguna forma con las características químicas descriptivas de la muestra tomada o con alguna otra variable (tipo del río, época del año en la que se tomó la muestra, etc.).</p></li>
</ul>
</section>
<section id="datasets" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="datasets"><span class="header-section-number">5.2</span> Datasets</h2>
<p>ID: <strong><code>DMwR2::algae</code></strong>.</p>
<p>Los datos para este estudio provienen de la competición internacional de análisis de datos COIL 1999, y están disponibles a través de diferentes fuentes, incluyendo el <a href="http://archive.ics.uci.edu/ml/">UCI Machine Learning Repository</a>.</p>
<p>El conjunto de datos contiene en total 200 muestras tomadas de diferentes ríos europeos. Los datos pueden cargarse directamente desde el paquete <code>DMwR2</code> de la siguiente forma:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(algae, <span class="at">package=</span><span class="st">"DMwR2"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>algae</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 × 18
   season size  speed   mxPH  mnO2    Cl    NO3   NH4  oPO4   PO4  Chla    a1
   &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 winter small medium  8      9.8  60.8  6.24  578   105   170   50      0  
 2 spring small medium  8.35   8    57.8  1.29  370   429.  559.   1.3    1.4
 3 autumn small medium  8.1   11.4  40.0  5.33  347.  126.  187.  15.6    3.3
 4 spring small medium  8.07   4.8  77.4  2.30   98.2  61.2 139.   1.4    3.1
 5 autumn small medium  8.06   9    55.4 10.4   234.   58.2  97.6 10.5    9.2
 6 winter small high    8.25  13.1  65.8  9.25  430    18.2  56.7 28.4   15.1
 7 summer small high    8.15  10.3  73.2  1.54  110    61.2 112.   3.2    2.4
 8 autumn small high    8.05  10.6  59.1  4.99  206.   44.7  77.4  6.9   18.2
 9 winter small medium  8.7    3.4  22.0  0.886 103.   36.3  71    5.54  25.4
10 winter small high    7.93   9.9   8    1.39    5.8  27.2  46.6  0.8   17  
# ℹ 190 more rows
# ℹ 6 more variables: a2 &lt;dbl&gt;, a3 &lt;dbl&gt;, a4 &lt;dbl&gt;, a5 &lt;dbl&gt;, a6 &lt;dbl&gt;,
#   a7 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Cada observación (fila) contiene información sobre 11 variables, tres de las cuales son categóricas y el resto cuantitativas:</p>
<ul>
<li><code>season</code>: Estación del año en la que se tomó la muestra.</li>
<li><code>size</code>: Tamaño del río.</li>
<li><code>speed</code>: Velocidad de las aguas del río.</li>
<li><code>mxPH</code>: Máximo valor del PH del río.</li>
<li><code>mnO2</code>: Mínimo valor de oxígeno del río.</li>
<li><code>Cl</code>: Valor medio de cloro.</li>
<li><code>NO3</code>: Valor medio de nitratos.</li>
<li><code>NH4</code>: Valor medio de amonio.</li>
<li><code>oPO4</code>: Valor medio de ortofosfato.</li>
<li><code>PO4</code>: Valor medio de total de fosfatos.</li>
<li><code>Chla</code>: Valor medio de clorofila.</li>
<li><code>a1</code> hasta <code>a7</code>: Frecuencia de aparición de cada uno de los 7 tipos de algas dañinas analizados en la muestra de agua tomada.</li>
</ul>
<p>Adicionalmente, existe otro data set en el mismo paquete, llamado <code>test.algae</code>, que contiene otras 140 observaciones adicionales, conteniendo las mismas variables descriptivas, pero que no contiene las columnas correspondientes a los valores de frecuencia de cada especie de algas.</p>
<p>En este contexto, podemos usar <code>algae</code> como un conjunto de datos de <em>entrenamiento</em> para nuestro modelo, mientra que <code>test.algae</code> se puede usar como conjunto de datos de test. Finalmente, el dataset <code>algae.sols</code> contiene los valores de las 7 columnas restantes con las frecuencias de aparición de cada especie de algas para cada fila del testing set <code>test.alage</code>. De este modo, podemos evaluar el modelo propuesto.</p>
</section>
<section id="descripción-y-preparación-de-datos" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="descripción-y-preparación-de-datos"><span class="header-section-number">5.3</span> Descripción y preparación de datos</h2>
<section id="análisis-descriptivo" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="análisis-descriptivo"><span class="header-section-number">5.3.1</span> Análisis descriptivo</h3>
<p>Un primer resumen descriptivo de las variables implicadas en el análisis es:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(algae)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>algae 

 18  Variables      200  Observations
--------------------------------------------------------------------------------
season 
       n  missing distinct 
     200        0        4 
                                      
Value      autumn spring summer winter
Frequency      40     53     45     62
Proportion  0.200  0.265  0.225  0.310
--------------------------------------------------------------------------------
size 
       n  missing distinct 
     200        0        3 
                               
Value       large medium  small
Frequency      45     84     71
Proportion  0.225  0.420  0.355
--------------------------------------------------------------------------------
speed 
       n  missing distinct 
     200        0        3 
                               
Value        high    low medium
Frequency      84     33     83
Proportion  0.420  0.165  0.415
--------------------------------------------------------------------------------
mxPH 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     199        1       72    0.998    8.012     8.05   0.6471    7.081 
     .10      .25      .50      .75      .90      .95 
   7.340    7.700    8.060    8.400    8.700    8.873 

lowest : 5.6  5.7  6.4  6.5  6.6 , highest: 9    9.06 9.1  9.5  9.7 
--------------------------------------------------------------------------------
mnO2 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     198        2       88        1    9.118     9.35    2.629    4.485 
     .10      .25      .50      .75      .90      .95 
   5.770    7.725    9.800   10.800   11.700   11.815 

lowest : 1.5  1.8  3.2  3.3  3.4 , highest: 12.5 12.6 12.9 13.1 13.4
--------------------------------------------------------------------------------
Cl 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     190       10      178        1    43.64    36.38    43.78    3.061 
     .10      .25      .50      .75      .90      .95 
   4.970   10.981   32.730   57.823   88.600  130.087 

lowest : 0.222   0.8     1.17    1.45    1.549  
highest: 173.75  187.183 194.75  208.364 391.5  
--------------------------------------------------------------------------------
NO3 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     198        2      192        1    3.282    2.867    2.884   0.4023 
     .10      .25      .50      .75      .90      .95 
  0.6912   1.2960   2.6750   4.4463   6.1916   7.9369 

lowest : 0.05   0.102  0.13   0.23   0.267 , highest: 9.248  9.715  9.773  10.416 45.65 
--------------------------------------------------------------------------------
NH4 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     198        2      179        1    501.3      131    816.2    10.00 
     .10      .25      .50      .75      .90      .95 
   15.00    38.33   103.17   226.95   805.33  1922.87 

lowest : 5       5.8     8       10      10.5   
highest: 4073.33 5738.33 6400    8777.6  24064  
--------------------------------------------------------------------------------
oPO4 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     198        2      173        1    73.59    52.77    85.46     2.00 
     .10      .25      .50      .75      .90      .95 
    3.94    15.70    40.15    99.33   193.21   248.34 

lowest : 1       1.25    1.333   1.625   1.8    
highest: 346.167 412.333 428.75  467.5   564.6  
--------------------------------------------------------------------------------
PO4 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     198        2      189        1    137.9      125    133.9    6.455 
     .10      .25      .50      .75      .90      .95 
  11.350   41.375  103.285  213.750  286.100  345.650 

lowest : 1       2.5     3       4       6      
highest: 558.75  586     607.167 624.733 771.6  
--------------------------------------------------------------------------------
Chla 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     188       12      131        1    13.97     9.35    17.93    0.500 
     .10      .25      .50      .75      .90      .95 
   0.800    2.000    5.475   18.308   31.817   61.733 

lowest : 0.2     0.3     0.4     0.5     0.6    
highest: 88.255  92.667  93.683  98.817  110.456
--------------------------------------------------------------------------------
a1 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     200        0      121    0.994    16.92    12.45    21.52     0.00 
     .10      .25      .50      .75      .90      .95 
    0.00     1.50     6.95    24.80    50.72    64.33 

lowest : 0    1.1  1.2  1.4  1.5 , highest: 75.8 81.9 82.7 86.6 89.8
--------------------------------------------------------------------------------
a2 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     200        0       89    0.951    7.458     5.25    10.19     0.00 
     .10      .25      .50      .75      .90      .95 
    0.00     0.00     3.00    11.38    21.50    28.38 

lowest : 0    1    1.2  1.4  1.5 , highest: 40.7 40.9 41   53.6 72.6
--------------------------------------------------------------------------------
a3 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     200        0       79    0.949    4.309      2.4    6.131    0.000 
     .10      .25      .50      .75      .90      .95 
   0.000    0.000    1.550    4.925   13.510   20.275 

lowest : 0    1    1.1  1.2  1.4 , highest: 24.8 25.3 25.9 35.1 42.8
--------------------------------------------------------------------------------
a4 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     200        0       50    0.838    1.992      1.1    3.032    0.000 
     .10      .25      .50      .75      .90      .95 
   0.000    0.000    0.000    2.400    5.000    7.605 

lowest : 0    1    1.1  1.2  1.3 , highest: 11.5 12.7 13.4 28.8 44.6
--------------------------------------------------------------------------------
a5 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     200        0       81    0.938    5.064      3.7    6.923     0.00 
     .10      .25      .50      .75      .90      .95 
    0.00     0.00     1.90     7.50    14.91    20.04 

lowest : 0    1    1.1  1.2  1.4 , highest: 28.8 34.2 34.3 35.6 44.4
--------------------------------------------------------------------------------
a6 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     200        0       76    0.847    5.964     2.95    9.323    0.000 
     .10      .25      .50      .75      .90      .95 
   0.000    0.000    0.000    6.925   17.110   31.815 

lowest : 0    1    1.2  1.4  1.5 , highest: 42.7 49.4 52.5 64.6 77.6
--------------------------------------------------------------------------------
a7 
       n  missing distinct     Info     Mean  pMedian      Gmd      .05 
     200        0       51    0.882    2.496      1.2    3.817     0.00 
     .10      .25      .50      .75      .90      .95 
    0.00     0.00     1.00     2.40     6.10    10.88 

lowest : 0    1    1.1  1.2  1.4 , highest: 22.1 25.6 30.1 31.2 31.6
--------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>También podemos obtener varios gráficos que permiten hacernos una idea de la posible correlación entre algunas de las variables de nuestro conjunto de datos. Estos ejemplos los podemos encontrar en el epígrafe <a href="http://ltorgo.github.io/DMwR2/Ralgae.html#data_visualization_and_summarization">“Data Visualization and Summarization”</a> de la página que contiene el código original para el caso de estudio.</p>
<p>Particularmente importantes son los comandos para organizar las etiquetas de las variables categóricas siguiendo un orden en particular:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> algae <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">size=</span><span class="fu">fct_relevel</span>(size,<span class="fu">c</span>(<span class="st">"small"</span>,<span class="st">"medium"</span>,<span class="st">"large"</span>)),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">speed=</span><span class="fu">fct_relevel</span>(speed,<span class="fu">c</span>(<span class="st">"low"</span>,<span class="st">"medium"</span>,<span class="st">"high"</span>)),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">season=</span><span class="fu">fct_relevel</span>(season,<span class="fu">c</span>(<span class="st">"spring"</span>,<span class="st">"summer"</span>,<span class="st">"autumn"</span>,<span class="st">"winter"</span>)))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Donde usamos la biblioteca <code>forcats</code>, de reciente creación y parte del metapaquete <code>tidyverse</code> (con paquetes asociados al concepto de Tidy Data promulgado por H. Wickham). Este paquete contiene funciones muy útiles para operar con variables categóricas en el contexto de <em>tidy data</em> <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>También es interesante representar el valor de la concentración de algas en función de alguna de las variables categóricas, de forma que podamos explorar posibles correlaciones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data2graph <span class="ot">&lt;-</span> <span class="fu">filter</span>(algae,<span class="sc">!</span><span class="fu">is.na</span>(mnO2)) <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">minO2=</span><span class="fu">cut</span>(mnO2, <span class="fu">quantile</span>(mnO2,<span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>,.<span class="dv">5</span>,.<span class="dv">75</span>,<span class="dv">1</span>)), <span class="at">include.lowest=</span><span class="cn">TRUE</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data2graph,<span class="fu">aes</span>(<span class="at">x=</span>a3,<span class="at">y=</span>season, <span class="at">color=</span>season)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> minO2) <span class="sc">+</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color=</span><span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Cdplot de freq. alga a3 vs. estación del año"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-algae-cdplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-algae-cdplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-modelos-clasicos_files/figure-html/fig-algae-cdplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-algae-cdplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.1: Caption
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">cor</span>(algae[,<span class="dv">4</span><span class="sc">:</span><span class="dv">18</span>], <span class="at">use=</span><span class="st">"complete.obs"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cm, <span class="at">type=</span><span class="st">"upper"</span>, <span class="at">tl.pos=</span><span class="st">"d"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cm, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">type=</span><span class="st">"lower"</span>,<span class="at">method=</span><span class="st">"number"</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag=</span><span class="cn">FALSE</span>, <span class="at">tl.pos=</span><span class="st">"n"</span>, <span class="at">cl.pos=</span><span class="st">"n"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-corrplot" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-corrplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-modelos-clasicos_files/figure-html/fig-corrplot-1.png" id="fig-corrplot" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-corrplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.2
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="imputación-de-datos-faltantes" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="imputación-de-datos-faltantes"><span class="header-section-number">5.3.2</span> Imputación de datos faltantes</h3>
<p>Las siguientes secciones del ejemplo muestran código paso a paso para implementar algunas de las técnicas de imputación que hemos visto en este documento. A veces encontraremos funciones de utilidad que el autor del paquete ha creado para automatizar métodos de imputación avanzados, por ejemplo <code>knnImputation</code> para imputación de valores faltantes utilizando información de los <span class="math inline">\(k\)</span> vecinos más próximos a un punto dado.</p>
<ul>
<li><a href="http://ltorgo.github.io/DMwR2/Ralgae.html#removing_the_observations_with_unknown_values">Eliminación de casos con valores faltantes</a>.</li>
<li><a href="http://ltorgo.github.io/DMwR2/Ralgae.html#filling_in_the_unknowns_with_the_most_frequent_values">Imputación con valores más frecuentes</a>.</li>
<li><a href="http://ltorgo.github.io/DMwR2/Ralgae.html#filling_in_the_unknown_values_by_exploring_correlations">Imputación mediante exploración de correlaciones entre los datos</a>.</li>
<li><a href="http://ltorgo.github.io/DMwR2/Ralgae.html#filling_in_the_unknown_values_by_exploring_similarities_between_cases">Imputación de datos mediante búsqueda de similiaridad</a>.</li>
</ul>
</section>
</section>
<section id="ajuste-de-modelosalgoritmos" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="ajuste-de-modelosalgoritmos"><span class="header-section-number">5.4</span> Ajuste de modelos/algoritmos</h2>
<p>En las siguientes secciones, el ejemplo continua desarrollando varios tipos de modelos para los datos disponibles:</p>
<ul>
<li>Un modelo de predicción basado en regresión lineal múltiple.</li>
<li>Un modelo orientado a inferencia, creando árboles de regresión.</li>
<li>Un algoritmo de ensamblado de modelos, Random Forests.</li>
</ul>
<section id="regresión-lineal-múltiple" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="regresión-lineal-múltiple"><span class="header-section-number">5.4.1</span> Regresión lineal múltiple</h3>
<p>Para este caso, en primer lugar debemos de rellenar los datos faltantes con algún método de imputación de datos. Aquí se utiliza el método de fijarnos en las obseraciones del dataset de entrenamiento que son similares a las que contienen datos faltantes para rellenar los valores desconocidos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span>  algae[<span class="sc">-</span><span class="fu">manyNAs</span>(algae), ]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>clean.algae <span class="ot">&lt;-</span> <span class="fu">knnImputation</span>(algae, <span class="at">k =</span> <span class="dv">10</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comenzamos por ajustar un modelo <em>saturado</em>, es decir, con todas las posibles variables que se han observado, para ir simplificándolo paulatinamente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lm_a1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(a1 <span class="sc">~</span> ., <span class="at">data =</span> clean.algae[, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_a1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = a1 ~ ., data = clean.algae[, 1:12])

Residuals:
    Min      1Q  Median      3Q     Max 
-37.692 -11.894  -2.531   7.359  62.178 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  60.380064  21.919304   2.755  0.00647 **
seasonsummer -2.985251   3.742399  -0.798  0.42609   
seasonautumn -3.707641   4.135847  -0.896  0.37119   
seasonwinter -0.010954   3.394378  -0.003  0.99743   
sizemedium   -6.401875   3.447182  -1.857  0.06491 . 
sizelarge    -9.675740   4.175134  -2.317  0.02159 * 
speedmedium  -3.701776   4.107879  -0.901  0.36870   
speedhigh    -3.958606   4.701947  -0.842  0.40094   
mxPH         -3.596932   2.704224  -1.330  0.18514   
mnO2          1.053401   0.704865   1.494  0.13678   
Cl           -0.040892   0.033645  -1.215  0.22578   
NO3          -1.510771   0.551190  -2.741  0.00674 **
NH4           0.001632   0.001003   1.628  0.10533   
oPO4         -0.005208   0.039867  -0.131  0.89620   
PO4          -0.052335   0.030742  -1.702  0.09039 . 
Chla         -0.088703   0.079962  -1.109  0.26876   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.64 on 182 degrees of freedom
Multiple R-squared:  0.3736,    Adjusted R-squared:  0.3219 
F-statistic: 7.236 on 15 and 182 DF,  p-value: 2.314e-12</code></pre>
</div>
</div>
<p>Después, se puede utilizar un análisis ANOVA para efectuar un análisis secuencial de la construcción del modelo, viendo cómo se reduce el RSS (error total) conforme añadimos términos a la fórmula en cada paso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lm_a1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: a1
           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
season      3     85    28.2  0.0906 0.9651608    
size        2  11401  5700.7 18.3213 5.632e-08 ***
speed       2   3934  1967.2  6.3222 0.0022155 ** 
mxPH        1   1313  1312.8  4.2193 0.0413968 *  
mnO2        1   2297  2296.5  7.3807 0.0072288 ** 
Cl          1   4361  4360.7 14.0147 0.0002431 ***
NO3         1   3409  3409.3 10.9569 0.0011244 ** 
NH4         1    403   403.4  1.2965 0.2563459    
oPO4        1   4772  4772.1 15.3367 0.0001271 ***
PO4         1   1413  1413.2  4.5418 0.0344180 *  
Chla        1    383   382.9  1.2306 0.2687586    
Residuals 182  56630   311.2                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><code>season</code> es la variable que menos contribuye a reducir el error total, así que la eliminamos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lm2_a1 <span class="ot">&lt;-</span> <span class="fu">update</span>(lm_a1, . <span class="sc">~</span> . <span class="sc">-</span> season)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2_a1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = a1 ~ size + speed + mxPH + mnO2 + Cl + NO3 + NH4 + 
    oPO4 + PO4 + Chla, data = clean.algae[, 1:12])

Residuals:
    Min      1Q  Median      3Q     Max 
-36.466 -11.774  -2.987   7.428  63.708 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  5.832e+01  2.167e+01   2.691  0.00778 **
sizemedium  -6.951e+00  3.390e+00  -2.051  0.04172 * 
sizelarge   -1.027e+01  4.117e+00  -2.495  0.01346 * 
speedmedium -3.380e+00  4.077e+00  -0.829  0.40821   
speedhigh   -3.094e+00  4.607e+00  -0.672  0.50271   
mxPH        -3.267e+00  2.658e+00  -1.229  0.22065   
mnO2         8.022e-01  6.587e-01   1.218  0.22486   
Cl          -3.892e-02  3.337e-02  -1.166  0.24501   
NO3         -1.532e+00  5.475e-01  -2.798  0.00568 **
NH4          1.576e-03  9.947e-04   1.585  0.11475   
oPO4        -6.010e-03  3.949e-02  -0.152  0.87921   
PO4         -5.106e-02  3.051e-02  -1.674  0.09586 . 
Chla        -8.489e-02  7.942e-02  -1.069  0.28653   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.57 on 185 degrees of freedom
Multiple R-squared:  0.3686,    Adjusted R-squared:  0.3276 
F-statistic:     9 on 12 and 185 DF,  p-value: 1.668e-13</code></pre>
</div>
</div>
<p>Volvemos a usar ANOVA, pero ahora para comprobar la mejora entre los dos modelos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lm_a1, lm2_a1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: a1 ~ season + size + speed + mxPH + mnO2 + Cl + NO3 + NH4 + oPO4 + 
    PO4 + Chla
Model 2: a1 ~ size + speed + mxPH + mnO2 + Cl + NO3 + NH4 + oPO4 + PO4 + 
    Chla
  Res.Df   RSS Df Sum of Sq     F Pr(&gt;F)
1    182 56630                          
2    185 57079 -3   -449.02 0.481 0.6959</code></pre>
</div>
</div>
<p>La función <code>step()</code> permite realizar una eliminación secuencial hacia atras (<em>backward elimination</em>) para simplificar el modelo, usando en cada paso el <em>Akaike Information Criterion</em> (AIC) para identificar la variable candidata a ser eliminada.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=1151.89
a1 ~ season + size + speed + mxPH + mnO2 + Cl + NO3 + NH4 + oPO4 + 
    PO4 + Chla

         Df Sum of Sq   RSS    AIC
- season  3    449.02 57079 1147.5
- speed   2    274.12 56904 1148.8
- oPO4    1      5.31 56635 1149.9
- Chla    1    382.90 57013 1151.2
- Cl      1    459.64 57090 1151.5
- mxPH    1    550.50 57180 1151.8
&lt;none&gt;                56630 1151.9
- mnO2    1    694.94 57325 1152.3
- NH4     1    824.31 57454 1152.8
- PO4     1    901.78 57532 1153.0
- size    2   1855.68 58486 1154.3
- NO3     1   2337.60 58968 1157.9

Step:  AIC=1147.46
a1 ~ size + speed + mxPH + mnO2 + Cl + NO3 + NH4 + oPO4 + PO4 + 
    Chla

        Df Sum of Sq   RSS    AIC
- speed  2    214.41 57293 1144.2
- oPO4   1      7.15 57086 1145.5
- Chla   1    352.48 57431 1146.7
- Cl     1    419.66 57499 1146.9
- mnO2   1    457.55 57537 1147.0
- mxPH   1    465.99 57545 1147.1
&lt;none&gt;               57079 1147.5
- NH4    1    774.78 57854 1148.1
- PO4    1    864.40 57943 1148.4
- size   2   2177.14 59256 1150.9
- NO3    1   2416.12 59495 1153.7

Step:  AIC=1144.2
a1 ~ size + mxPH + mnO2 + Cl + NO3 + NH4 + oPO4 + PO4 + Chla

       Df Sum of Sq   RSS    AIC
- oPO4  1     15.75 57309 1142.2
- Chla  1    227.71 57521 1143.0
- mnO2  1    413.56 57707 1143.6
- mxPH  1    480.09 57773 1143.8
- Cl    1    489.31 57783 1143.9
&lt;none&gt;              57293 1144.2
- NH4   1    718.17 58012 1144.7
- PO4   1    810.82 58104 1145.0
- size  2   2058.91 59352 1147.2
- NO3   1   2373.68 59667 1150.2

Step:  AIC=1142.25
a1 ~ size + mxPH + mnO2 + Cl + NO3 + NH4 + PO4 + Chla

       Df Sum of Sq   RSS    AIC
- Chla  1     212.9 57522 1141.0
- mnO2  1     402.6 57712 1141.6
- Cl    1     487.1 57796 1141.9
- mxPH  1     516.3 57825 1142.0
&lt;none&gt;              57309 1142.2
- NH4   1     702.9 58012 1142.7
- size  2    2049.1 59358 1145.2
- NO3   1    2364.8 59674 1148.3
- PO4   1    5802.7 63112 1159.3

Step:  AIC=1140.99
a1 ~ size + mxPH + mnO2 + Cl + NO3 + NH4 + PO4

       Df Sum of Sq   RSS    AIC
- mnO2  1     434.9 57957 1140.5
- Cl    1     452.4 57974 1140.5
&lt;none&gt;              57522 1141.0
- NH4   1     745.8 58268 1141.5
- mxPH  1     834.5 58357 1141.8
- size  2    2217.8 59740 1144.5
- NO3   1    2663.9 60186 1148.0
- PO4   1    6296.4 63818 1159.5

Step:  AIC=1140.48
a1 ~ size + mxPH + Cl + NO3 + NH4 + PO4

       Df Sum of Sq   RSS    AIC
- NH4   1     530.2 58487 1140.3
&lt;none&gt;              57957 1140.5
- Cl    1     601.4 58558 1140.5
- mxPH  1     818.8 58776 1141.3
- size  2    2480.4 60437 1144.8
- NO3   1    2248.6 60206 1146.0
- PO4   1    9079.2 67036 1167.3

Step:  AIC=1140.28
a1 ~ size + mxPH + Cl + NO3 + PO4

       Df Sum of Sq   RSS    AIC
&lt;none&gt;              58487 1140.3
- mxPH  1     782.6 59270 1140.9
- Cl    1     855.1 59342 1141.2
- NO3   1    1985.7 60473 1144.9
- size  2    2667.0 61154 1145.1
- PO4   1    8557.9 67045 1165.3</code></pre>
</div>
</div>
<p>Inspeccionamos el modelo final.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(final_lm)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = a1 ~ size + mxPH + Cl + NO3 + PO4, data = clean.algae[, 
    1:12])

Residuals:
    Min      1Q  Median      3Q     Max 
-28.876 -12.707  -3.718   8.413  62.910 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  67.66988   19.18518   3.527 0.000526 ***
sizemedium   -7.60277    3.14190  -2.420 0.016466 *  
sizelarge   -10.40755    3.81939  -2.725 0.007029 ** 
mxPH         -3.96549    2.48058  -1.599 0.111560    
Cl           -0.05289    0.03165  -1.671 0.096337 .  
NO3          -0.89491    0.35143  -2.547 0.011669 *  
PO4          -0.05906    0.01117  -5.287 3.39e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.5 on 191 degrees of freedom
Multiple R-squared:  0.353, Adjusted R-squared:  0.3327 
F-statistic: 17.37 on 6 and 191 DF,  p-value: 5.299e-16</code></pre>
</div>
</div>
<p>Observamos que el <span class="math inline">\(R_{adj}^2\)</span> es tan sólo <span class="math inline">\(0.3324\)</span>, un resultado cuanto menos demasiado modesto. Entre otras posibles causas, esto puede indicar que los presupuestos de linealidad que exige este modelo tan sencillo no son aplicables a este problema.</p>
</section>
<section id="árboles-de-regresión" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="árboles-de-regresión"><span class="header-section-number">5.4.2</span> Árboles de regresión</h3>
<p>En el caso del modelo orientado a inferencia estadística, la construcción se centra en la variable de salida <code>a1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(algae, <span class="at">package=</span><span class="st">"DMwR2"</span>) </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> algae[<span class="sc">-</span><span class="fu">manyNAs</span>(algae), ]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>rt_a1 <span class="ot">&lt;-</span> <span class="fu">rpart</span>(a1 <span class="sc">~</span> ., <span class="at">data =</span> algae[, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>rt_a1</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 198 

node), split, n, deviance, yval
      * denotes terminal node

 1) root 198 90401.290 16.996460  
   2) PO4&gt;=43.818 147 31279.120  8.979592  
     4) Cl&gt;=7.8065 140 21622.830  7.492857  
       8) oPO4&gt;=51.118 84  3441.149  3.846429 *
       9) oPO4&lt; 51.118 56 15389.430 12.962500  
        18) mnO2&gt;=10.05 24  1248.673  6.716667 *
        19) mnO2&lt; 10.05 32 12502.320 17.646870  
          38) NO3&gt;=3.1875 9   257.080  7.866667 *
          39) NO3&lt; 3.1875 23 11047.500 21.473910  
            78) mnO2&lt; 8 13  2919.549 13.807690 *
            79) mnO2&gt;=8 10  6370.704 31.440000 *
     5) Cl&lt; 7.8065 7  3157.769 38.714290 *
   3) PO4&lt; 43.818 51 22442.760 40.103920  
     6) mxPH&lt; 7.87 28 11452.770 33.450000  
      12) mxPH&gt;=7.045 18  5146.169 26.394440 *
      13) mxPH&lt; 7.045 10  3797.645 46.150000 *
     7) mxPH&gt;=7.87 23  8241.110 48.204350  
      14) PO4&gt;=15.177 12  3047.517 38.183330 *
      15) PO4&lt; 15.177 11  2673.945 59.136360 *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(rt_a1) # Produce mucha información</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función rpart.plot::prp</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(rt_a1, <span class="at">extra=</span><span class="dv">101</span>, <span class="at">box.col=</span><span class="st">"orange"</span>, <span class="at">split.box.col=</span><span class="st">"grey"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-reg-tree" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-reg-tree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-modelos-clasicos_files/figure-html/fig-reg-tree-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-reg-tree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.3: Cálculo y representación de un modelo de árbol de regresión para el dataset <code>algae</code>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Partiendo de este árbol complejo y profundo podemos simplificar el modelo podándolo mediante el criterio de <em>cost complexity</em>, implementado en el paquete <code>rpart</code>. El método de poda intenta seguir una solución de compromiso entre la capacidad predictiva del modelo y y el tamaño del árbol. Utilizando este criterio, R puede calcular subconjuntos del árbol original estimando su capacidad predictiva. Esta información está disponible mediante la función <code>printcp()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(rt_a1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regression tree:
rpart(formula = a1 ~ ., data = algae[, 1:12])

Variables actually used in tree construction:
[1] Cl   mnO2 mxPH NO3  oPO4 PO4 

Root node error: 90401/198 = 456.57

n= 198 

        CP nsplit rel error  xerror    xstd
1 0.405740      0   1.00000 1.01682 0.13179
2 0.071885      1   0.59426 0.75652 0.12233
3 0.030887      2   0.52237 0.76744 0.12647
4 0.030408      3   0.49149 0.75587 0.12276
5 0.027872      4   0.46108 0.75783 0.12308
6 0.027754      5   0.43321 0.73354 0.12233
7 0.018124      6   0.40545 0.76590 0.12386
8 0.016344      7   0.38733 0.78798 0.12754
9 0.010000      9   0.35464 0.79041 0.12807</code></pre>
</div>
</div>
<p>Según <span class="citation" data-cites="torgo_data_2016">(<a href="references.html#ref-torgo_data_2016" role="doc-biblioref">Torgo, 2016</a>)</span>, se pueden seguir varios criterios para seleccionar el árbol más adecuado:</p>
<ol type="1">
<li><p>Seleccionando aquel que tenga el menor error relativo estimado (columna <code>xerror</code> en la salida). En este caso sería el tercer árbol.</p></li>
<li><p>Seleccionando aquel que tenga el menor error de validación cruzada estimado (columna <code>xerror</code>) más 1-SE (columna <code>xstd</code>). En este caso, sería el árbol más pequeño cuyo valor en la columna <code>xerror</code> sea menor que <span class="math inline">\(0.67151 + 0.11508\)</span>. Se seleccionaría el árbol número 2.</p></li>
</ol>
<p>Si nos quedamos con el árbol número dos, usamo el valor de <code>cp = 0.08</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>rt2_a1 <span class="ot">&lt;-</span> <span class="fu">prune</span>(rt_a1, <span class="at">cp =</span> <span class="fl">0.08</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>rt2_a1 </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 198 

node), split, n, deviance, yval
      * denotes terminal node

1) root 198 90401.29 16.996460  
  2) PO4&gt;=43.818 147 31279.12  8.979592 *
  3) PO4&lt; 43.818 51 22442.76 40.103920 *</code></pre>
</div>
</div>
<p>La función <code>DMwR2::rpartXse</code> automatiza todo este proceso.</p>
</section>
<section id="random-forests" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="random-forests"><span class="header-section-number">5.4.3</span> Random Forests</h3>
<p>Comparemos ahora lo que ocurre cuando enfrentamos el modelo de regresión lineal múltiple y el modelo basado en árbol de decisión con un algoritmo más robusto y avanzado, como Random Forests (RF), basado en un método de ensamblado de árboles de decisión aleatorizados. El paquete <code>performanceEstimation</code> permite utilizar una sintáxis muy explícita para configurar el proceso de ajuste y comparación de modelos.</p>
<p>La métrica utilizada en este caso es el NMSE (<em>Normalised MSE</em>), que se obtiene calculando el cociente entre el rendimiento de nuestro modelo y el de un modelo de base (<em>baseline</em>) como, por ejemplo, el valor promedio de la salida (<em>null model</em>).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>

##### PERFORMANCE ESTIMATION USING  CROSS VALIDATION  #####

** PREDICTIVE TASK :: a1

++ MODEL/WORKFLOW :: lm 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


** PREDICTIVE TASK :: a2

++ MODEL/WORKFLOW :: lm 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


** PREDICTIVE TASK :: a3

++ MODEL/WORKFLOW :: lm 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


** PREDICTIVE TASK :: a4

++ MODEL/WORKFLOW :: lm 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


** PREDICTIVE TASK :: a5

++ MODEL/WORKFLOW :: lm 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


** PREDICTIVE TASK :: a6

++ MODEL/WORKFLOW :: lm 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


** PREDICTIVE TASK :: a7

++ MODEL/WORKFLOW :: lm 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: rpartXse.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v1 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v2 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************


++ MODEL/WORKFLOW :: randomForest.v3 
Task for estimating  nmse  using
 5 x 10 - Fold Cross Validation
     Run with seed =  1234 
Iteration :**************************************************</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rankWorkflows</span>(res_all, <span class="at">top=</span><span class="dv">3</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$a1
$a1$nmse
         Workflow  Estimate
1 randomForest.v2 0.5515591
2 randomForest.v1 0.5517816
3 randomForest.v3 0.5520359


$a2
$a2$nmse
         Workflow  Estimate
1 randomForest.v2 0.7806102
2 randomForest.v3 0.7809335
3 randomForest.v1 0.7832804


$a3
$a3$nmse
         Workflow  Estimate
1 randomForest.v3 0.9804490
2 randomForest.v2 0.9843171
3 randomForest.v1 0.9892036


$a4
$a4$nmse
         Workflow  Estimate
1 randomForest.v1 0.9326347
2 randomForest.v2 0.9432211
3 randomForest.v3 0.9433387


$a5
$a5$nmse
         Workflow  Estimate
1 randomForest.v3 0.7842300
2 randomForest.v2 0.7852252
3 randomForest.v1 0.7874437


$a6
$a6$nmse
         Workflow  Estimate
1              lm 0.8664797
2 randomForest.v2 0.8988809
3 randomForest.v3 0.9003739


$a7
$a7$nmse
         Workflow Estimate
1     rpartXse.v2 1.000000
2     rpartXse.v3 1.000000
3 randomForest.v3 1.016322</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">pairedComparisons</span>(res_all, <span class="at">baseline=</span><span class="st">"randomForest.v3"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>nmse<span class="sc">$</span>F.test</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$chi
[1] 23.44898

$FF
[1] 7.584158

$critVal
[1] 0.6524015

$rejNull
[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>nmse<span class="sc">$</span>BonferroniDunn.test</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$critDif
[1] 3.046397

$baseline
[1] "randomForest.v3"

$rkDifs
             lm     rpartXse.v1     rpartXse.v2     rpartXse.v3 randomForest.v1 
      2.5714286       4.1428571       2.5714286       2.2857143       0.7142857 
randomForest.v2 
      0.2857143 

$signifDifs
             lm     rpartXse.v1     rpartXse.v2     rpartXse.v3 randomForest.v1 
          FALSE            TRUE           FALSE           FALSE           FALSE 
randomForest.v2 
          FALSE </code></pre>
</div>
</div>
</section>
</section>
<section id="predicción-de-valores" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="predicción-de-valores"><span class="header-section-number">5.5</span> Predicción de valores</h2>
<p>Finalmente, se ofrecen varias alternativas de evaluación de los modelos propuestos, centrado en la utilización del paquete <code>performanceEstimation</code> desarrollado por el mismo autor (Torgo, 2014).</p>
<p>La última sección ofrece pasos detallados para calcular las predicciones del modelo seleccionado, utilizando el testing dataset de 140 casos adicionales. Podemos encontrar también el código en <a href="http://ltorgo.github.io/DMwR2/Ralgae.html#predictions_for_the_seven_algae">la sección “Predictions for Seven Algae”</a> del documento de este caso de estudio.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-torgo_data_2016" class="csl-entry" role="listitem">
Torgo, L. (2016). <em>Data <span>Mining</span> with <span>R</span>: <span>Learning</span> with <span>Case</span> <span>Studies</span>, <span>Second</span> <span>Edition</span></em>. CRC Press. <a href="https://books.google.es/books?id=2aedDQAAQBAJ">https://books.google.es/books?id=2aedDQAAQBAJ</a>
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Más información sobre los paquetes que componen el <em>tidyverse</em> disponible en http://tidyverse.org/.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04-seleccion-validacion.html" class="pagination-link" aria-label="Selección y validación de modelos">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Selección y validación de modelos</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-modelos-avanzados.html" class="pagination-link" aria-label="Modelos avanzados">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modelos avanzados</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>